# Diagramas de Secuencia: MÃ³dulo de GestiÃ³n de Usuarios

**VersiÃ³n:** 1.0  
**Fecha:** Febrero 2026  
**MÃ³dulo:** Sprint 1 - GestiÃ³n de Usuarios y AutenticaciÃ³n

---

## Tabla de Contenidos

1. [DS-01: Iniciar SesiÃ³n + Verificar 2FA](#ds-01-iniciar-sesiÃ³n--verificar-2fa)
2. [DS-02: Crear Usuario](#ds-02-crear-usuario)
3. [DS-03: Listar y Buscar Usuarios](#ds-03-listar-y-buscar-usuarios)
4. [DS-04: Editar Usuario](#ds-04-editar-usuario)
5. [DS-05: Eliminar Usuario](#ds-05-eliminar-usuario)
6. [DS-06: Ver Perfil Propio](#ds-06-ver-perfil-propio)

---

## Participantes (Objetos)

| Participante | Tipo | DescripciÃ³n |
|-------------|------|-------------|
| **Actor** | Actor | Cualquier usuario del sistema |
| **Frontend** | Boundary | Interfaz React (`Login.jsx`, `Users.jsx`) |
| **AuthController** | Controller | `auth_routes.py` - Controlador de autenticaciÃ³n |
| **AdminController** | Controller | `admin_routes.py` - Controlador administrativo |
| **AuthService** | Service | `security.py` - Servicio de seguridad (JWT, bcrypt) |
| **EmailService** | Service | `email_service.py` - Servicio de correo electrÃ³nico |
| **Database** | Entity | PostgreSQL / SQLAlchemy ORM |

---

## DS-01: Iniciar SesiÃ³n + Verificar 2FA

**Caso de Uso:** CU-01 + CU-02  
**Actor:** Cualquier usuario registrado  
**DescripciÃ³n:** Flujo completo de autenticaciÃ³n con verificaciÃ³n en dos pasos.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Actor â”‚          â”‚ Frontend â”‚          â”‚AuthControllerâ”‚     â”‚AuthServiceâ”‚     â”‚EmailService â”‚     â”‚ Database â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  1. Accede a /login                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  Muestra formulario    â”‚                   â”‚                   â”‚                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (usuario + contraseÃ±a)â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  2. Ingresa       â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  username y       â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  contraseÃ±a       â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  3. POST /api/auth/login                  â”‚                   â”‚                 â”‚
    â”‚                   â”‚  {username, password}  â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  4. SELECT * FROM users               â”‚                 â”‚
    â”‚                   â”‚                       â”‚  WHERE username = ? OR email = ?      â”‚                 â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  5. Retorna datos del usuario         â”‚                 â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  6. verify_password(                  â”‚                 â”‚
    â”‚                   â”‚                       â”‚     password,     â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚     hashed_password)                  â”‚                 â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  7. âœ“ ContraseÃ±a vÃ¡lida               â”‚                 â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  8. Verifica is_active == true         â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  9. Genera cÃ³digo 2FA                 â”‚                 â”‚
    â”‚                   â”‚                       â”‚     (6 dÃ­gitos aleatorios)             â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  10. Almacena cÃ³digo                  â”‚                 â”‚
    â”‚                   â”‚                       â”‚      en memoria temporal              â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  11. send_2fa_code(email, code)       â”‚                 â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚  EnvÃ­a email    â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚  con cÃ³digo â”€â”€â”€â”€â–¶ ğŸ“§
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  12. 200 OK            â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  {message: "CÃ³digo     â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚   enviado al correo"}  â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  13. Muestra campoâ”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  para cÃ³digo 2FA  â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  14. Revisa email â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  e ingresa cÃ³digo â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  de 6 dÃ­gitos     â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  15. POST /api/auth/verify-2fa            â”‚                   â”‚                 â”‚
    â”‚                   â”‚  {username, code}      â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  16. Compara cÃ³digo                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  ingresado vs almacenado              â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  17. âœ“ CÃ³digo vÃ¡lido                  â”‚                 â”‚
    â”‚                   â”‚                       â”‚  Elimina cÃ³digo (uso Ãºnico)            â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  18. SELECT * FROM users               â”‚                 â”‚
    â”‚                   â”‚                       â”‚  WHERE username = ?                    â”‚                 â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  19. Datos del usuario                â”‚                 â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  20. create_access_token(              â”‚                 â”‚
    â”‚                   â”‚                       â”‚     {sub: username,â”‚                  â”‚                 â”‚
    â”‚                   â”‚                       â”‚      role: role})  â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  21. Token JWT firmado                â”‚                 â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  22. 200 OK            â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  {access_token,        â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚   user: {...}}         â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  23. Almacena token    â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  en localStorage       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  24. Redirige al  â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  Dashboard segÃºn  â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚  rol del usuario  â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                   â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                   â”‚                 â”‚
```

### Flujos Alternativos

```
 FLUJO ALTERNATIVO FA-01: Credenciales Incorrectas
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 5: Usuario no encontrado O Paso 7: ContraseÃ±a no coincide
     AuthController â”€â”€â–¶ Frontend: 401 "Credenciales incorrectas"
     Frontend â”€â”€â–¶ Actor: Muestra error en formulario

 FLUJO ALTERNATIVO FA-02: Cuenta Desactivada
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 8: is_active == false
     AuthController â”€â”€â–¶ Frontend: 403 "Usuario desactivado"
     Frontend â”€â”€â–¶ Actor: Muestra mensaje de cuenta bloqueada

 FLUJO ALTERNATIVO FA-03: CÃ³digo 2FA Incorrecto
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 16: CÃ³digo no coincide
     AuthController â”€â”€â–¶ Frontend: 401 "CÃ³digo de verificaciÃ³n invÃ¡lido"
     Frontend â”€â”€â–¶ Actor: Permite reintentar ingreso de cÃ³digo
```

---

## DS-02: Crear Usuario

**Caso de Uso:** CU-03  
**Actor:** Superadmin  
**DescripciÃ³n:** CreaciÃ³n de un usuario interno del sistema con envÃ­o de credenciales por email.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Superadminâ”‚     â”‚ Frontend â”‚     â”‚AdminControllerâ”‚     â”‚AuthServiceâ”‚     â”‚EmailService â”‚     â”‚ Database â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  1. Accede a   â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  GestiÃ³n de    â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  Usuarios      â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  2. Click en   â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  "Crear Usuario"â”‚                  â”‚                   â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  Muestra modal â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  con formularioâ”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  3. Completa:  â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  - username    â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  - email       â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  - full_name   â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  - role        â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  4. POST /api/admin/users              â”‚                   â”‚                 â”‚
      â”‚                â”‚  {username, email, â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚   full_name, role} â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  Header: Authorization: Bearer JWT    â”‚                   â”‚                 â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  5. Verifica JWT + rol superadmin      â”‚                 â”‚
      â”‚                â”‚                   â”‚  (Middleware allow_superadmin)          â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  6. SELECT * FROM users                â”‚                 â”‚
      â”‚                â”‚                   â”‚  WHERE username = ? OR email = ?       â”‚                 â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  7. NULL (no existe)                   â”‚                 â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  8. _generate_password(12)             â”‚                 â”‚
      â”‚                â”‚                   â”‚  Genera contraseÃ±a aleatoria           â”‚                 â”‚
      â”‚                â”‚                   â”‚  (letras + nÃºmeros + sÃ­mbolos)         â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  9. hash_password(plain_password)      â”‚                 â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  10. Hash bcrypt   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  11. INSERT INTO users                 â”‚                 â”‚
      â”‚                â”‚                   â”‚  (username, email, hashed_password,    â”‚                 â”‚
      â”‚                â”‚                   â”‚   full_name, role, is_active=true)     â”‚                 â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  12. Usuario creado (id)               â”‚                 â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚  13. send_welcome_email(               â”‚                 â”‚
      â”‚                â”‚                   â”‚      email, password, role)            â”‚                 â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚  EnvÃ­a email    â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚  con credenciales
      â”‚                â”‚                   â”‚                   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ğŸ“§
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  14. 201 Created   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  {id, username,    â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚   email, role}     â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚  15. Cierra modalâ”‚                 â”‚                   â”‚                   â”‚                 â”‚
      â”‚  Muestra toast: â”‚                  â”‚                   â”‚                   â”‚                 â”‚
      â”‚  "Usuario creadoâ”‚                  â”‚                   â”‚                   â”‚                 â”‚
      â”‚   exitosamente" â”‚                  â”‚                   â”‚                   â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  16. Recarga lista â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚  GET /api/admin/users                  â”‚                   â”‚                 â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚                 â”‚
      â”‚                â”‚                   â”‚                   â”‚                   â”‚                 â”‚
```

### Flujos Alternativos

```
 FLUJO ALTERNATIVO FA-01: Username o Email Duplicado
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 7: SELECT retorna un usuario existente
     AdminController â”€â”€â–¶ Frontend: 400 "Ya existe un usuario con ese username/email"
     Frontend â”€â”€â–¶ Superadmin: Muestra error en el formulario

 FLUJO ALTERNATIVO FA-02: Sin Permisos
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 5: JWT no tiene rol superadmin
     Middleware â”€â”€â–¶ Frontend: 403 "No tiene permisos"
     Frontend â”€â”€â–¶ Actor: Redirige o muestra error
```

---

## DS-03: Listar y Buscar Usuarios

**Caso de Uso:** CU-04  
**Actor:** Superadmin, SecretarÃ­a  
**DescripciÃ³n:** Consulta paginada de usuarios con filtro de bÃºsqueda.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actor   â”‚     â”‚ Frontend â”‚     â”‚AdminControllerâ”‚     â”‚ Database â”‚
â”‚(SA o Sec.)â”‚     â”‚ Users.jsxâ”‚     â”‚admin_routes.pyâ”‚     â”‚PostgreSQLâ”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  1. Navega a   â”‚                   â”‚                   â”‚
      â”‚  /admin/users  â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  2. GET /api/admin/users?skip=0&limit=50
      â”‚                â”‚  Header: Authorization: Bearer JWT    â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  3. Verifica JWT   â”‚
      â”‚                â”‚                   â”‚  + rol (SA o Sec.) â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  4. SELECT COUNT(*) FROM users
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  5. total = N      â”‚           â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  6. SELECT * FROM users       â”‚
      â”‚                â”‚                   â”‚  OFFSET 0 LIMIT 50            â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  7. Lista de usuarios         â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  8. 200 OK         â”‚                   â”‚
      â”‚                â”‚  {total: N,        â”‚                   â”‚
      â”‚                â”‚   items: [...]}    â”‚                   â”‚
      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  9. Muestra tabla                  â”‚                   â”‚
      â”‚  con usuarios   â”‚                  â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ BÃšSQUEDA (OPCIONAL) â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  10. Escribe en â”‚                  â”‚                   â”‚
      â”‚  campo bÃºsqueda:â”‚                  â”‚                   â”‚
      â”‚  "juan"         â”‚                  â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  11. GET /api/admin/users?search=juan  â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  12. SELECT * FROM users
      â”‚                â”‚                   â”‚  WHERE username ILIKE '%juan%'
      â”‚                â”‚                   â”‚  OR email ILIKE '%juan%'
      â”‚                â”‚                   â”‚  OR full_name ILIKE '%juan%'
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  13. Resultados filtrados     â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  14. 200 OK (filtrado)                â”‚
      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  15. Actualiza  â”‚                  â”‚                   â”‚
      â”‚  tabla con      â”‚                  â”‚                   â”‚
      â”‚  resultados     â”‚                  â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
```

---

## DS-04: Editar Usuario

**Caso de Uso:** CU-05  
**Actor:** Superadmin  
**DescripciÃ³n:** ModificaciÃ³n de datos de un usuario existente.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Superadminâ”‚     â”‚ Frontend â”‚     â”‚AdminControllerâ”‚     â”‚ Database â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  1. Click botÃ³nâ”‚                   â”‚                   â”‚
      â”‚  "Editar" en   â”‚                   â”‚                   â”‚
      â”‚  usuario       â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  2. Muestra modal                 â”‚                   â”‚
      â”‚  con datos actuales               â”‚                   â”‚
      â”‚  del usuario    â”‚                  â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  3. Modifica   â”‚                   â”‚                   â”‚
      â”‚  campos:       â”‚                   â”‚                   â”‚
      â”‚  - email       â”‚                   â”‚                   â”‚
      â”‚  - full_name   â”‚                   â”‚                   â”‚
      â”‚  - role        â”‚                   â”‚                   â”‚
      â”‚  - is_active   â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  4. Click      â”‚                   â”‚                   â”‚
      â”‚  "Guardar"     â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  5. PATCH /api/admin/users/{user_id}  â”‚
      â”‚                â”‚  {email, full_name, role, is_active}  â”‚
      â”‚                â”‚  Header: Authorization: Bearer JWT    â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  6. Verifica JWT   â”‚
      â”‚                â”‚                   â”‚  + rol superadmin  â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  7. SELECT * FROM users
      â”‚                â”‚                   â”‚  WHERE id = user_idâ”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  8. Usuario encontrado        â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  9. Si cambiÃ³ email:          â”‚
      â”‚                â”‚                   â”‚  SELECT * FROM users          â”‚
      â”‚                â”‚                   â”‚  WHERE email = ? AND id != ?  â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  10. NULL (email disponible)  â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  11. UPDATE users SET         â”‚
      â”‚                â”‚                   â”‚  email=?, full_name=?,        â”‚
      â”‚                â”‚                   â”‚  role=?, is_active=?          â”‚
      â”‚                â”‚                   â”‚  WHERE id = user_id           â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  12. âœ“ Actualizado            â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  13. 200 OK        â”‚                   â”‚
      â”‚                â”‚  {datos actualizados}                 â”‚
      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  14. Cierra modal                 â”‚                   â”‚
      â”‚  Toast: "Actualizado"              â”‚                   â”‚
      â”‚  Recarga lista  â”‚                  â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
```

### Flujos Alternativos

```
 FLUJO ALTERNATIVO FA-01: Email Duplicado
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 10: SELECT retorna un usuario con ese email
     AdminController â”€â”€â–¶ Frontend: 400 "Ya existe un usuario con ese email"
     Frontend â”€â”€â–¶ Superadmin: Muestra error en modal

 FLUJO ALTERNATIVO FA-02: Usuario No Encontrado
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 8: SELECT retorna NULL
     AdminController â”€â”€â–¶ Frontend: 404 "Usuario no encontrado"
     Frontend â”€â”€â–¶ Superadmin: Muestra error y recarga lista
```

---

## DS-05: Eliminar Usuario

**Caso de Uso:** CU-06  
**Actor:** Superadmin, SecretarÃ­a  
**DescripciÃ³n:** EliminaciÃ³n de un usuario con validaciones de seguridad.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actor   â”‚     â”‚ Frontend â”‚     â”‚AdminControllerâ”‚     â”‚ Database â”‚
â”‚(SA o Sec.)â”‚     â”‚ Users.jsxâ”‚     â”‚admin_routes.pyâ”‚     â”‚PostgreSQLâ”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  1. Click botÃ³nâ”‚                   â”‚                   â”‚
      â”‚  "Eliminar" en â”‚                   â”‚                   â”‚
      â”‚  usuario       â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  2. Muestra diÃ¡logo               â”‚                   â”‚
      â”‚  de confirmaciÃ³n:â”‚                 â”‚                   â”‚
      â”‚  "Â¿EstÃ¡ seguro?" â”‚                 â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  3. Confirma   â”‚                   â”‚                   â”‚
      â”‚  eliminaciÃ³n   â”‚                   â”‚                   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  4. DELETE /api/admin/users/{user_id}  â”‚
      â”‚                â”‚  Header: Authorization: Bearer JWT    â”‚
      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  5. Verifica JWT   â”‚
      â”‚                â”‚                   â”‚  + rol (SA o Sec.) â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  6. SELECT * FROM users
      â”‚                â”‚                   â”‚  WHERE id = user_idâ”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  7. Usuario encontrado        â”‚
      â”‚                â”‚                   â”‚  {id, username, role}         â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  8. Validaciones:  â”‚
      â”‚                â”‚                   â”‚  âœ“ user_id != current_user.id â”‚
      â”‚                â”‚                   â”‚    (no auto-eliminaciÃ³n)      â”‚
      â”‚                â”‚                   â”‚  âœ“ Si actor=Secretary:        â”‚
      â”‚                â”‚                   â”‚    target.role == entity_user â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚  9. DELETE FROM users         â”‚
      â”‚                â”‚                   â”‚  WHERE id = user_id           â”‚
      â”‚                â”‚                   â”‚  (CASCADE: elimina            â”‚
      â”‚                â”‚                   â”‚   notifications)              â”‚
      â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                â”‚                   â”‚                   â”‚           â”‚
      â”‚                â”‚                   â”‚  10. âœ“ Eliminado              â”‚
      â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚                â”‚  11. 200 OK        â”‚                   â”‚
      â”‚                â”‚  {message: "Usuarioâ”‚                   â”‚
      â”‚                â”‚   eliminado"}      â”‚                   â”‚
      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
      â”‚  12. Toast:     â”‚                  â”‚                   â”‚
      â”‚  "Eliminado"   â”‚                   â”‚                   â”‚
      â”‚  Recarga lista  â”‚                  â”‚                   â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
      â”‚                â”‚                   â”‚                   â”‚
```

### Flujos Alternativos

```
 FLUJO ALTERNATIVO FA-01: Auto-eliminaciÃ³n
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 8: user_id == current_user.id
     AdminController â”€â”€â–¶ Frontend: 400 "No puedes eliminarte a ti mismo"

 FLUJO ALTERNATIVO FA-02: Secretary sin permisos sobre rol
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 8: Actor=Secretary Y target.role != entity_user
     AdminController â”€â”€â–¶ Frontend: 403 "Solo puedes eliminar usuarios de tipo Entidad"

 FLUJO ALTERNATIVO FA-03: CancelaciÃ³n
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Paso 3: Actor presiona "Cancelar"
     Frontend: Cierra diÃ¡logo, sin acciÃ³n
```

---

## DS-06: Ver Perfil Propio

**Caso de Uso:** CU-07  
**Actor:** Cualquier usuario autenticado  
**DescripciÃ³n:** Consulta del perfil del usuario actualmente autenticado.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Actor â”‚          â”‚ Frontend â”‚          â”‚AuthControllerâ”‚     â”‚AuthServiceâ”‚     â”‚ Database â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚  1. Click en      â”‚                       â”‚                   â”‚                 â”‚
    â”‚  "Mi Perfil"      â”‚                       â”‚                   â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚  2. GET /api/auth/me   â”‚                   â”‚                 â”‚
    â”‚                   â”‚  Header: Authorization:â”‚Bearer JWT         â”‚                 â”‚
    â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  3. Extrae token   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  del header        â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  4. decode_token(jwt)                â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  5. {sub: username,â”‚                 â”‚
    â”‚                   â”‚                       â”‚      role: role}   â”‚                 â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  6. SELECT * FROM users              â”‚
    â”‚                   â”‚                       â”‚  WHERE username = ?                  â”‚
    â”‚                   â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  7. Datos del usuario                â”‚
    â”‚                   â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚  8. Verifica is_active == true        â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚  9. 200 OK             â”‚                   â”‚                 â”‚
    â”‚                   â”‚  {id, username, email, â”‚                   â”‚                 â”‚
    â”‚                   â”‚   full_name, role,     â”‚                   â”‚                 â”‚
    â”‚                   â”‚   institution_id,      â”‚                   â”‚                 â”‚
    â”‚                   â”‚   created_at}          â”‚                   â”‚                 â”‚
    â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
    â”‚  10. Muestra datosâ”‚                       â”‚                   â”‚                 â”‚
    â”‚  del perfil       â”‚                       â”‚                   â”‚                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                   â”‚                 â”‚
    â”‚                   â”‚                       â”‚                   â”‚                 â”‚
```

---

## Resumen de Interacciones

| Diagrama | MÃ©todo HTTP | Endpoint | Mensajes | Tablas |
|----------|-------------|----------|----------|--------|
| DS-01 | POST + POST | `/auth/login` + `/auth/verify-2fa` | 24 | users |
| DS-02 | POST | `/admin/users` | 16 | users |
| DS-03 | GET | `/admin/users` | 15 | users |
| DS-04 | PATCH | `/admin/users/{id}` | 14 | users |
| DS-05 | DELETE | `/admin/users/{id}` | 12 | users, notifications |
| DS-06 | GET | `/auth/me` | 10 | users |

---

**Fin del Documento**
